<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸° - ëª¨ë°”ì¼ ìŒì„±ì¶œë ¥ ê°•í™”ë²„ì „</title>
<style>
body{font-family:sans-serif;text-align:center;padding:20px;background:#f9fafb;}
input{font-size:2em;padding:10px;width:200px;margin:10px;border-radius:10px;text-align:center;}
button{font-size:1.6em;padding:12px 25px;border:none;background:#2b4eff;color:white;border-radius:12px;}
table{margin:20px auto;border-collapse:collapse;width:90%;background:white;}
th,td{border:1px solid #ccc;padding:12px;}
</style>
</head>
<body>
<h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸° (ëª¨ë°”ì¼ ìŒì„±ì¶œë ¥ ê°•í™”)</h2>
<input id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸">
<button id="btnCheck">ì¡°íšŒ</button>
<button id="btnVoice">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>
<div id="status"></div>
<table id="resultTable" style="display:none;"><tbody></tbody></table>

<script>
const carData = [{ë²ˆí˜¸:"0114",ìƒ‰ìƒ:"í°ìƒ‰",ì°¨ì¢…:"ë ˆì´",ì£¼ì°¨ìŠ¤í‹°ì»¤:"ìˆìŒ(í™©ìƒ‰)"}];

let recognition=null;
let pendingSpeak=null;
let ttsAllowUntil=0;

function allowTTS(){
  ttsAllowUntil=Date.now()+12000;
}

document.getElementById("btnVoice").addEventListener("click",()=>{allowTTS();startVoice();});
document.getElementById("btnCheck").addEventListener("click",()=>{allowTTS();checkCar();});

function speak(text){
  if(!text) return;
  if(Date.now()>ttsAllowUntil){
    document.getElementById("status").textContent="ğŸ”‡ ìŠ¤ë§ˆíŠ¸í° ì •ì±…ìœ¼ë¡œ ìŒì„± ì¶œë ¥ì´ ì°¨ë‹¨ë¨ â†’ ë²„íŠ¼ì„ í•œë²ˆ ë” ëˆŒëŸ¬ì£¼ì„¸ìš”.";
    return;
  }
  try{ speechSynthesis.cancel(); }catch(e){}
  const u=new SpeechSynthesisUtterance(text);
  u.lang="ko-KR";
  speechSynthesis.speak(u);
}

function checkCar(){
  const num=document.getElementById("carInput").value.replace(/\D/g,"").padStart(4,"0");
  let found=carData.find(c=>c.ë²ˆí˜¸===num);
  if(found){
    pendingSpeak=`${num}ë²ˆ ì°¨ëŸ‰ í™•ì¸ë¨. ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}`;
    document.getElementById("status").textContent="í™•ì¸ë¨";
    document.querySelector("#resultTable tbody").innerHTML=
      `<tr><td>${found.ë²ˆí˜¸}</td><td>${found.ìƒ‰ìƒ}</td><td>${found.ì°¨ì¢…}</td><td>${found.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td></tr>`;
    document.getElementById("resultTable").style.display="table";
  }else{
    pendingSpeak=`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
    document.getElementById("status").textContent=pendingSpeak;
    document.getElementById("resultTable").style.display="none";
  }
  if(recognition){
    try{recognition.stop();}catch(e){}
  }else{
    speak(pendingSpeak); pendingSpeak=null;
  }
}

function startVoice(){
  if(!("webkitSpeechRecognition" in window)){
    alert("í¬ë¡¬ ë¸Œë¼ìš°ì € í•„ìš”"); return;
  }
  recognition=new webkitSpeechRecognition();
  recognition.lang="ko-KR"; recognition.interimResults=false;

  recognition.onresult=function(e){
    let t=e.results[0][0].transcript;
    let num=t.replace(/[^0-9]/g,"");
    document.getElementById("carInput").value=num;
    checkCar();
  };

  recognition.onend=function(){
    if(pendingSpeak){
      setTimeout(()=>{speak(pendingSpeak); pendingSpeak=null;},150);
    }
    recognition=null;
  };

  recognition.start();
}
</script>
</body>
</html>
