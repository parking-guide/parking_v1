<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #2b4eff; }
  input {
    font-size: 1.2em;
    padding: 10px;
    width: 200px;
    margin: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    text-align: center;
  }
  button {
    font-size: 1.1em;
    padding: 10px 20px;
    border: none;
    background: #2b4eff;
    color: white;
    border-radius: 10px;
  }
  button:active { background: #1a36b0; }
  table {
    margin: 20px auto;
    border-collapse: collapse;
    width: 90%;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
  }
  th { background: #f1f3f6; }
  #status { margin-top: 15px; font-weight: bold; color: #333; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥">
  <button onclick="checkCar()">ì¡°íšŒ</button>
  <button onclick="startVoice()">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>

  <div id="status"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // ğŸ”¹ ì°¨ëŸ‰ ë°ì´í„° (HTML ì•ˆì—ì„œ ì§ì ‘ ìˆ˜ì •/ì¶”ê°€ ê°€ëŠ¥)
  const carData = [
  { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
  { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
  { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
  { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
  { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
  { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
  { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
  ];

  const inputEl = document.getElementById("carInput");
  const statusEl = document.getElementById("status");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");
  
  // í˜„ì¬ ìŒì„± ì¸ì‹ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
  let recognition; 

  // **â­ì¶”ê°€: ë§ˆì´í¬ ê¶Œí•œ ìœ ì§€ë¥¼ ìœ„í•œ í”Œë˜ê·¸ (HTTPS í™˜ê²½ í•„ìˆ˜)**
  let isContinuous = false; 

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") checkCar();
  });

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰ í•¨ìˆ˜
  function checkCar() {
    // ìŒì„± ì¸ì‹ ì¤‘ì´ì—ˆìœ¼ë©´ ì¢…ë£Œ ì²˜ë¦¬
    if (recognition) {
        recognition.stop();
        // recognition = null; // onendì—ì„œ ì²˜ë¦¬
    }

    const num = inputEl.value.replace(/\D/g, "").padStart(4, "0");
    if (!num || num === "0000") {
      speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      // **â­ìˆ˜ì •: ë²ˆí˜¸ ì…ë ¥ì´ ì—†ìœ¼ë©´ ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ë¡œì§ ì¶”ê°€**
      if (isContinuous) {
          startVoice();
      }
      return;
    }

    // ê²°ê³¼ ì²˜ë¦¬ ë¡œì§
    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    if (found) {
      showResult(found);
      // **â­ìˆ˜ì •: ê°„ë‹¨í•œ ìŒì„± ì•ˆë‚´**
      // speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`); 
      speak("ë“±ë¡ëœ ì°¨ëŸ‰ì…ë‹ˆë‹¤. ì£¼ì°¨ ìŠ¤í‹°ì»¤ " + found.ì£¼ì°¨ìŠ¤í‹°ì»¤ + "ì…ë‹ˆë‹¤."); 
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
      // **â­ìˆ˜ì •: ê°„ë‹¨í•œ ìŒì„± ì•ˆë‚´**
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }
    
    // **â­ì¶”ê°€: ì—°ì† ëª¨ë“œì¼ ê²½ìš°, ì¡°íšŒ í›„ ì¬ì‹œì‘**
    if (isContinuous) {
        // ì§§ì€ ì§€ì—° í›„ ì¬ì‹œì‘í•˜ì—¬ ìŒì„± ì¶œë ¥ ì™„ë£Œë¥¼ ê¸°ë‹¤ë¦¼
        setTimeout(() => {
            if (!recognition) { // checkCar()ì—ì„œ stop()ì„ í˜¸ì¶œí–ˆìœ¼ë¯€ë¡œ recognitionì€ nullì´ ë  ì˜ˆì •
                startVoice();
            }
        }, 1500);
    }
  }

  // ğŸ”¹ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
  function showResult(data) {
    tbody.innerHTML = `
      <tr>
        <td>${data.ë²ˆí˜¸}</td>
        <td>${data.ìƒ‰ìƒ}</td>
        <td>${data.ì°¨ì¢…}</td>
        <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    `;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸° í•¨ìˆ˜
  function speak(text) {
    // ìŒì„± ì¶œë ¥ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
    speechSynthesis.cancel(); 
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ko-KR";
    utter.rate = 1.2; // ë§í•˜ëŠ” ì†ë„ ì¡°ê¸ˆ ë¹ ë¥´ê²Œ ì„¤ì •
    speechSynthesis.speak(utter);
  }

  // ğŸ”¹ ìŒì„± ì¸ì‹ ì‹œì‘ í•¨ìˆ˜
  function startVoice() {
    // ì´ë¯¸ ì¸ì‹ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (recognition) return; 

    if (!("webkitSpeechRecognition" in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\ní¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }

    // **â­ìˆ˜ì •: continuous ì†ì„±ì„ trueë¡œ ì„¤ì •**
    isContinuous = true; // ì—°ì† ì¸ì‹ ëª¨ë“œ í™œì„±í™” (ê¶Œí•œ ìœ ì§€ ëª©ì )
    recognition = new webkitSpeechRecognition(); 
    recognition.lang = "ko-KR";
    recognition.continuous = isContinuous; 
    recognition.interimResults = false; 
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
        statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";
        table.style.display = "none";
    };
    
    // ì¸ì‹ ì„±ê³µ
    recognition.onresult = function(event) {
      // recognition.stop(); // onresultì—ì„œ stopì„ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒ ë°œí™”ê°€ ì¸ì‹ë˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ checkCar()ì—ì„œ ì²˜ë¦¬
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ
      
      // ë²ˆí˜¸ ì¶”ì¶œì´ ë¶ˆì™„ì „í•˜ë‹¤ê³  íŒë‹¨ë˜ë©´
      if (num.length < 2 || num.length > 4) {
          statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
          speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”.");
          // ì—°ì† ëª¨ë“œì´ë¯€ë¡œ ì ì‹œ í›„ ì¬ì‹œì‘ ë¡œì§ì€ onendì™€ checkCarì—ì„œ ì²˜ë¦¬ë¨
      } else {
          inputEl.value = num;
          checkCar(); // checkCar ë‚´ë¶€ì—ì„œ recognition.stop() í˜¸ì¶œ
      }
    };

    // ì¸ì‹ì´ ëë‚¬ì„ ë•Œ
    recognition.onend = function() {
        if (recognition) {
            recognition = null; 
            // **â­ì¶”ê°€: ì—°ì† ëª¨ë“œì¼ ë•Œë§Œ ì˜ˆìƒì¹˜ ëª»í•œ ì¢…ë£Œ(timeout ë“±) ì‹œ ì¬ì‹œì‘**
            if (isContinuous) { 
                statusEl.textContent = "ìŒì„± ì¸ì‹ì´ ëŒ€ê¸° ìƒíƒœë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìë™ ì¬ì‹œì‘ ì‹œë„ ì¤‘...";
                // ì§§ì€ ì§€ì—° í›„ ì¬ì‹œì‘í•˜ì—¬ ì‹œìŠ¤í…œ ë¶€ë‹´ ì¤„ì´ê¸°
                setTimeout(startVoice, 500); 
                return; // ì¬ì‹œì‘ì„ ì‹œë„í–ˆìœ¼ë¯€ë¡œ í•¨ìˆ˜ ì¢…ë£Œ
            }
        }
        statusEl.textContent = "ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.";
    };
    
    // â­ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì²˜ë¦¬ ë¡œì§
    recognition.onerror = function(event) {
        let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì¼ë°˜ ì˜¤ë¥˜)";
        
        switch(event.error) {
            case 'not-allowed':
                errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”. (HTTPS í™˜ê²½ì´ ì•„ë‹ˆë©´ ë§¤ë²ˆ ë¬¼ì–´ë³¼ ìˆ˜ ìˆìŒ)";
                speak(errorMsg);
                isContinuous = false; // ê¶Œí•œì´ ì—†ìœ¼ë©´ ì—°ì† ëª¨ë“œ í•´ì œ
                break;
            case 'no-speech':
                errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.";
                // 'no-speech' ì˜¤ë¥˜ëŠ” ì¬ì‹œì‘ ì‹œë„ (continuous: trueê°€ ì•„ë‹ˆì–´ë„ ìë™ ì¬ì‹œì‘)
                statusEl.textContent = errorMsg + " (ìë™ ì¬ì‹œì‘)";
                speak("ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.");
                recognition.start();
                return; 
            case 'service-not-allowed':
                errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. **HTTPS í™˜ê²½**ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                isContinuous = false;
                break;
            case 'aborted':
                errorMsg = "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."; // checkCar()ì—ì„œ stop()ì„ í˜¸ì¶œí•œ ê²½ìš° í¬í•¨
                break;
            default:
                // ê¸°íƒ€ ì˜¤ë¥˜ ì‹œ (ì˜ˆ: timeout)
                statusEl.textContent = errorMsg + ` (ì˜¤ë¥˜ ì½”ë“œ: ${event.error}) ìë™ ì¬ì‹œì‘ì„ ì‹œë„í•©ë‹ˆë‹¤.`;
                speak(errorMsg + " ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
                
                if (isContinuous && recognition) {
                    try {
                        recognition.start();
                        return; 
                    } catch(e) {
                        errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ì‹¤íŒ¨: " + e.message;
                    }
                }
                isContinuous = false;
                break;
        }

        statusEl.textContent = errorMsg;
        recognition = null; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê°ì²´ ì´ˆê¸°í™”
    };
    
    recognition.start();
  }
  </script>
</body>
</html>