<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #2b4eff; }
  input {
    font-size: 1.2em;
    padding: 10px;
    width: 200px;
    margin: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    text-align: center;
  }
  button {
    font-size: 1.1em;
    padding: 10px 20px;
    border: none;
    background: #2b4eff;
    color: white;
    border-radius: 10px;
  }
  button:active { background: #1a36b0; }
  table {
    margin: 20px auto;
    border-collapse: collapse;
    width: 90%;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
  }
  th { background: #f1f3f6; }
  #status { margin-top: 15px; font-weight: bold; color: #333; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥">
  <button onclick="checkCar(false)">ì¡°íšŒ</button>
  <button onclick="startVoice()">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>

  <div id="status"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // ğŸ”¹ ì°¨ëŸ‰ ë°ì´í„°
  const carData = [
  { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
  { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
  { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
  { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
  { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
  { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
  { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
  ];

  const inputEl = document.getElementById("carInput");
  const statusEl = document.getElementById("status");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");
  
  let recognition; 
  let isContinuous = false; // ì—°ì† ì¸ì‹ ëª¨ë“œ í”Œë˜ê·¸

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") checkCar(false);
  });

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰ í•¨ìˆ˜
  // voiceCheck: ìŒì„± ì¸ì‹ì„ í†µí•´ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ì—¬ë¶€
  function checkCar(voiceCheck = false) {
    
    // â­â­ í•µì‹¬ ìˆ˜ì •: ìŒì„± ì¸ì‹ ì¤‘ì´ì–´ë„ recognition.stop() í˜¸ì¶œì„ ì œê±°í•©ë‹ˆë‹¤. 
    // stop() í˜¸ì¶œì´ onendë¥¼ ê°•ì œë¡œ ë°œìƒì‹œí‚¤ê³  ì¬ì‹œì‘ ì‹œ í”„ë¡¬í”„íŠ¸ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.
    
    const num = inputEl.value.replace(/\D/g, "").padStart(4, "0");
    if (!num || num === "0000") {
      if (voiceCheck) {
        speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      }
      return;
    }

    // ê²°ê³¼ ì²˜ë¦¬ ë¡œì§
    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    if (found) {
      showResult(found);
      // â­ ê°„ë‹¨í•œ ìŒì„± ì•ˆë‚´
      speak("ë“±ë¡ëœ ì°¨ëŸ‰ì…ë‹ˆë‹¤. ì£¼ì°¨ ìŠ¤í‹°ì»¤ " + found.ì£¼ì°¨ìŠ¤í‹°ì»¤ + "ì…ë‹ˆë‹¤."); 
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
      // â­ ê°„ë‹¨í•œ ìŒì„± ì•ˆë‚´
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }
    
    // â­ ì¡°íšŒê°€ ì™„ë£Œëœ í›„ input í•„ë“œë§Œ ì´ˆê¸°í™”í•˜ì—¬ ë‹¤ìŒ ë°œí™”ë¥¼ ê¸°ë‹¤ë¦¼
    inputEl.value = ""; 
    
    // ìŒì„± ì¸ì‹ ì¤‘ì´ë©´ ìƒíƒœ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ë¦¬ì…‹í•˜ì—¬ ë‹¤ìŒ ë°œí™”ë¥¼ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
    if (recognition && isContinuous) {
        // ìŒì„± ì¶œë ¥ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ì‹œ 'ë§í•´ì£¼ì„¸ìš”' ìƒíƒœë¡œ ë³€ê²½
        setTimeout(() => {
            statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”... (ì—°ì† ëª¨ë“œ ìœ ì§€ ì¤‘)";
        }, 1500); 
    }
  }

  // ğŸ”¹ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
  function showResult(data) {
    tbody.innerHTML = `
      <tr>
        <td>${data.ë²ˆí˜¸}</td>
        <td>${data.ìƒ‰ìƒ}</td>
        <td>${data.ì°¨ì¢…}</td>
        <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    `;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸° í•¨ìˆ˜
  function speak(text) {
    // ìŒì„± ì¶œë ¥ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸°
    speechSynthesis.cancel(); 
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ko-KR";
    utter.rate = 1.2; 
    speechSynthesis.speak(utter);
  }

  // ğŸ”¹ ìŒì„± ì¸ì‹ ì‹œì‘ í•¨ìˆ˜
  function startVoice() {
    // ì´ë¯¸ ì¸ì‹ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (recognition && recognition.running) return; 

    if (!("webkitSpeechRecognition" in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\ní¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }

    isContinuous = true; // ì—°ì† ì¸ì‹ ëª¨ë“œ í™œì„±í™” 
    recognition = new webkitSpeechRecognition(); 
    recognition.lang = "ko-KR";
    recognition.continuous = isContinuous; 
    recognition.interimResults = false; 
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
        statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”... (ì—°ì† ëª¨ë“œ ì‹œì‘)";
        // í…Œì´ë¸”ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì—¬ ìµœê·¼ ì¡°íšŒ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆë„ë¡ í•¨.
    };
    
    // ì¸ì‹ ì„±ê³µ
    recognition.onresult = function(event) {
      // â­â­ onresultì—ì„œ stop() í˜¸ì¶œì„ ì™„ì „íˆ ì œê±°. continuous: trueê°€ ì„¸ì…˜ì„ ìœ ì§€í•˜ë„ë¡ í•¨.
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ
      
      if (num.length < 2 || num.length > 4) {
          statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
          speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”.");
      } else {
          inputEl.value = num;
          checkCar(true); // ìŒì„±ìœ¼ë¡œ í˜¸ì¶œí–ˆìŒì„ ì•Œë¦¼
      }
    };

    // ì¸ì‹ì´ ëë‚¬ì„ ë•Œ (ëª¨ë°”ì¼ì—ì„œ timeout ë“±ìœ¼ë¡œ ì¸í•´ ìì£¼ ë°œìƒ)
    recognition.onend = function() {
        // â­â­ ì—°ì† ëª¨ë“œì´ê³  ì˜ˆìƒì¹˜ ëª»í•œ ì¢…ë£Œì¼ ê²½ìš°, ì¬ì‹œì‘ì„ ì‹œë„í•˜ì—¬ ê¶Œí•œ í”„ë¡¬í”„íŠ¸ ì¬ë“±ì¥ì„ ë§‰ìŠµë‹ˆë‹¤.
        if (isContinuous) { 
            statusEl.textContent = "ìŒì„± ì¸ì‹ì´ ëŒ€ê¸° ìƒíƒœë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ìë™ ì¬ì‹œì‘ ì‹œë„ ì¤‘)";
            
            // ì§§ì€ ì§€ì—° í›„ ì¬ì‹œì‘ ì‹œë„
            setTimeout(() => {
                try {
                    recognition.start(); // ê¸°ì¡´ ê°ì²´ë¥¼ ë‹¤ì‹œ ì‹œì‘
                } catch (e) {
                    // start()ê°€ ì‹¤íŒ¨í•˜ë©´, ì™„ì „íˆ ìƒˆë¡œ ì‹œì‘
                    statusEl.textContent = `âŒ ì¬ì‹œì‘ ì‹¤íŒ¨: ${e.message}. ìˆ˜ë™ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
                    recognition = null;
                }
            }, 500); // 0.5ì´ˆ í›„ ì¬ì‹œì‘
            return; 
        }
        
        // ì—°ì† ëª¨ë“œê°€ ì•„ë‹ˆë©´ ì™„ì „íˆ ì¢…ë£Œ
        statusEl.textContent = "ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.";
        recognition = null;
    };
    
    // â­ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì²˜ë¦¬ ë¡œì§
    recognition.onerror = function(event) {
        let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì¼ë°˜ ì˜¤ë¥˜)";
        
        switch(event.error) {
            case 'not-allowed':
                errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
                isContinuous = false; 
                recognition = null;
                break;
            case 'no-speech':
                errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”. (ìë™ ì¬ì‹œì‘)";
                // no-speechëŠ” onendë¥¼ ìœ ë°œí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ëª…ì‹œì ìœ¼ë¡œ ì¬ì‹œì‘
                if (isContinuous && recognition) {
                    recognition.start();
                    return;
                }
                break;
            case 'service-not-allowed':
                errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. **HTTPS í™˜ê²½**ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                isContinuous = false;
                recognition = null;
                break;
            case 'aborted':
                errorMsg = "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ìˆ˜ë™ ì¢…ë£Œ ë˜ëŠ” ì˜¤ë¥˜)";
                break;
            default:
                // ê¸°íƒ€ ì˜¤ë¥˜ ì‹œ (ì˜ˆ: timeout) onendì—ì„œ ì²˜ë¦¬ë˜ë„ë¡ ë‘¡ë‹ˆë‹¤.
                break;
        }

        if (event.error !== 'no-speech') {
            statusEl.textContent = errorMsg;
            speak(errorMsg);
        }
    };
    
    recognition.start();
  }
  </script>
</body>
</html>