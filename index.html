// ... (HTML ë° ìŠ¤íƒ€ì¼ ì½”ë“œ ìƒëµ) ...

  <script>
  // ... (carData, inputEl, statusEl ë“± ë³€ìˆ˜ ì„ ì–¸ ë° setup ì½”ë“œ ìƒëµ) ...

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰ í•¨ìˆ˜ (ì¬ìˆ˜ì •: TTS í˜¸ì¶œ ë¡œì§ ì œê±°)
  function checkCar() {
    // TTS ë¡œì§ì„ onresultë¡œ ì˜®ê¸°ê³ , ì´ í•¨ìˆ˜ëŠ” ë°ì´í„° ì²˜ë¦¬ ë° í™”ë©´ ì—…ë°ì´íŠ¸ë§Œ ë‹´ë‹¹
    const num = inputEl.value.replace(/\D/g, "").padStart(4, "0");
    if (!num) {
      // í‚¤ë³´ë“œ ì…ë ¥ ì‹œ ë¹ˆ ê°’ì¼ ê²½ìš°ì—ë§Œ speak í˜¸ì¶œ
      if (!recognition) { 
          speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      }
      return null; // ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ null ë°˜í™˜
    }

    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    
    // ê²°ê³¼ ì²˜ë¦¬ ë¡œì§ (ì›ë˜ ì½”ë“œì™€ ë™ì¼)
    if (found) {
      showResult(found);
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
    }
    
    // ì¸ì‹ ì„±ê³µ í›„ ê°ì²´ ì •ë¦¬ (ì´ì „ê³¼ ë™ì¼)
    if (recognition) {
        recognition.stop();
        recognition = null;
    }
    
    return found; // ê²€ìƒ‰ëœ ë°ì´í„° ë°˜í™˜
  }

  // ğŸ”¹ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼)
  function showResult(data) {
    tbody.innerHTML = `
      <tr>
        <td>${data.ë²ˆí˜¸}</td>
        <td>${data.ìƒ‰ìƒ}</td>
        <td>${data.ì°¨ì¢…}</td>
        <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    `;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸° í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼)
  function speak(text) {
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
    }
    
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ko-KR";
    
    speechSynthesis.speak(utter);
  }

  // ğŸ”¹ ìŒì„± ì¸ì‹ ì‹œì‘ í•¨ìˆ˜ (recognition.onresult ë¡œì§ ìˆ˜ì •)
  function startVoice() {
    // ì´ë¯¸ ì¸ì‹ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (recognition) return; 

    if (!("webkitSpeechRecognition" in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\ní¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }

    recognition = new webkitSpeechRecognition(); // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
    recognition.lang = "ko-KR";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
        statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";
    };
    
    // â­â­ ì¸ì‹ ì„±ê³µ ë¡œì§ (TTSë¥¼ ì´ ì‹œì ì— ë°”ë¡œ ì‹¤í–‰) â­â­
    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, "");
      let utteranceText = "";
      
      if (num.length >= 2 && num.length <= 4) {
          inputEl.value = num;
          
          // 1. checkCarë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  í™”ë©´ì— í‘œì‹œ
          const found = checkCar(); // checkCar ë‚´ë¶€ì—ì„œ recognition.stop() í˜¸ì¶œ
          
          // 2. TTSì— ì‚¬ìš©í•  ê²°ê³¼ ë©”ì‹œì§€ ìƒì„±
          if (found) {
            utteranceText = `${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`;
          } else {
            utteranceText = `${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
          }
          
          // 3. ìƒí˜¸ì‘ìš© ë¬¸ë§¥ì´ ì‚´ì•„ìˆì„ ë•Œ ì¦‰ì‹œ TTS í˜¸ì¶œ
          speak(utteranceText); 
          
      } else {
          statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
          speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”. ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
          recognition.start(); // ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘
      }
    };
    
    // ... (onend, onerror ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€) ...

    recognition.onend = function() {
        if (recognition) {
            recognition = null; 
        }
    };
    
    recognition.onerror = function(event) {
        // ... (ì˜¤ë¥˜ ì²˜ë¦¬ ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼) ...
        let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì¼ë°˜ ì˜¤ë¥˜)";
        
        switch(event.error) {
            case 'not-allowed':
                errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'network':
                errorMsg = "âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'no-speech':
                errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.";
                statusEl.textContent = errorMsg + " (ìë™ ì¬ì‹œì‘)";
                speak("ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.");
                recognition.start();
                return;
            case 'aborted':
                errorMsg = "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                break;
            case 'audio-capture':
                errorMsg = "âŒ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•±ì´ ë§ˆì´í¬ë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'service-not-allowed':
                errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. **HTTPS í™˜ê²½**ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            default:
                statusEl.textContent = errorMsg + ` (ì˜¤ë¥˜ ì½”ë“œ: ${event.error})`;
                speak(errorMsg + " ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
                
                if (recognition) {
                    try {
                        recognition.start();
                        return;
                    } catch(e) {
                        errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ì‹¤íŒ¨: " + e.message;
                    }
                }
                break;
        }

        statusEl.textContent = errorMsg;
        recognition = null;
    };
    
    recognition.start();
  }
  </script>
</body>
</html>