<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸° (ê¶Œí•œ ì¬ì‚¬ìš© ê°œì„ íŒ)</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #2b4eff; }
  input {
    font-size: 2.0em;
    padding: 10px;
    width: 200px;
    margin: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    text-align: center;
  }
  button {
    font-size: 1.2em;
    padding: 10px 16px;
    border: none;
    background: #2b4eff;
    color: white;
    border-radius: 10px;
    margin: 6px;
  }
  button:active { background: #1a36b0; }
  table {
    margin: 20px auto;
    border-collapse: collapse;
    width: 90%;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 15px;
  }
  th { background: #f1f3f6; }
  #status { margin-top: 15px; font-weight: bold; color: #333; min-height: 1.5em; }
  .hint { color:#666; font-size: 0.95em; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥" inputmode="numeric" maxlength="4">
  <div>
    <button id="btnSearch">ì¡°íšŒ</button>
    <button id="btnVoice">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>
    <button id="btnStop">â¹ï¸ ì¤‘ì§€</button>
  </div>
  <div class="hint">ì•ˆë“œë¡œì´ë“œ í¬ë¡¬ Â· HTTPS í™˜ê²½ì—ì„œ ê¶Œí•œì„ í•œ ë²ˆë§Œ í—ˆìš©í•˜ë©´, ì•±ì„ ìƒˆë¡œê³ ì¹¨í•˜ê¸° ì „ê¹Œì§€ëŠ” ê¶Œí•œ íŒì—…ì´ ë°˜ë³µë˜ì§€ ì•Šë„ë¡ ìµœì í™”í–ˆìŠµë‹ˆë‹¤.</div>

  <div id="status"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // ğŸ”¹ ì°¨ëŸ‰ ë°ì´í„°
  const carData = [
    { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
    { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
    { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
    { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
    { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
    { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
    { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
    { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
    { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
    { ë²ˆí˜¸: "9949", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ(í™•ì¸)", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "jeep" }
  ];

  const inputEl = document.getElementById("carInput");
  const statusEl = document.getElementById("status");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");
  const btnSearch = document.getElementById("btnSearch");
  const btnVoice = document.getElementById("btnVoice");
  const btnStop = document.getElementById("btnStop");

  // ìŒì„± í•©ì„±
  function speak(text) {
    try {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "ko-KR";
      speechSynthesis.speak(utter);
    } catch(e) {}
  }

  // ğŸ”¹ recognitionì„ ì•± ìƒì• ì£¼ê¸° ë™ì•ˆ 1íšŒë§Œ ìƒì„±í•˜ì—¬ ì¬ì‚¬ìš©
  let recognition = null;
  let isRecognizing = false;

  function initRecognitionOnce() {
    if (recognition || !('webkitSpeechRecognition' in window)) return;
    recognition = new webkitSpeechRecognition();
    recognition.lang = 'ko-KR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
      isRecognizing = true;
      statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";
    };

    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, "");
      if (num.length >= 2 && num.length <= 4) {
        inputEl.value = num;
        checkCar();
      } else {
        statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
        speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”.");
      }
    };

    recognition.onend = function() {
      isRecognizing = false;
      statusEl.textContent = statusEl.textContent || "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
    };

    recognition.onerror = function(event) {
      let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      switch(event.error) {
        case 'not-allowed':
          errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
          break;
        case 'network':
          errorMsg = "âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
          break;
        case 'no-speech':
          errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.";
          break;
        case 'audio-capture':
          errorMsg = "âŒ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•±ì´ ë§ˆì´í¬ë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
          break;
        case 'service-not-allowed':
          errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
          break;
        default:
          errorMsg = errorMsg + ` (ì˜¤ë¥˜ ì½”ë“œ: ${event.error})`;
      }
      statusEl.textContent = errorMsg;
    };
  }

  // ğŸ”¹ ì‚¬ì „ ê¶Œí•œ ìš”ì²­ (HTTPSì—ì„œë§Œ ë™ì‘)
  async function warmUpMicPermission() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      stream.getTracks().forEach(t => t.stop());
      console.log("ë§ˆì´í¬ ê¶Œí•œ ì‚¬ì „ í—ˆìš©ë¨");
    } catch (e) {
      console.warn("ë§ˆì´í¬ ê¶Œí•œ ì‚¬ì „ ìš”ì²­ ê±°ë¶€:", e);
    }
  }

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰
  function checkCar() {
    const num = (inputEl.value || "").replace(/\D/g, "").padStart(4, "0");
    if (!num.trim()) {
      speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      return;
    }
    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    if (found) {
      showResult(found);
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`);
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }
    // ê²°ê³¼ í›„ì—ëŠ” ì¸ì‹ë§Œ ì¢…ë£Œ (ê°ì²´ëŠ” ìœ ì§€)
    try { if (isRecognizing) recognition.stop(); } catch(e) {}
  }

  function showResult(data) {
    tbody.innerHTML = `
      <tr>
        <td>${data.ë²ˆí˜¸}</td>
        <td>${data.ìƒ‰ìƒ}</td>
        <td>${data.ì°¨ì¢…}</td>
        <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    `;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ë²„íŠ¼ ë™ì‘
  btnSearch.addEventListener('click', checkCar);
  inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkCar(); });

  btnVoice.addEventListener('click', () => {
    if (!('webkitSpeechRecognition' in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }
    initRecognitionOnce();
    if (!isRecognizing) {
      try { recognition.start(); } catch (e) {}
    }
  });

  btnStop.addEventListener('click', () => {
    if (recognition && isRecognizing) {
      try { recognition.stop(); } catch (e) {}
    }
  });

  // í˜ì´ì§€ ë¡œë“œì‹œ 1íšŒ ì´ˆê¸°í™” & ê¶Œí•œ ì›Œë°ì—…
  window.addEventListener('load', () => {
    initRecognitionOnce();
    warmUpMicPermission(); // ì‚¬ìš©ì ì œìŠ¤ì²˜ê°€ ìˆëŠ” í›„ í˜¸ì¶œì„ ê¶Œì¥í•˜ì§€ë§Œ, HTTPSë¼ë©´ ë¡œë“œ ì‹œë„ë„ ê°€ëŠ¥
  });
  </script>
</body>
</html>
