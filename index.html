<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 30.00px;
  }
  h2 { color: #2b4eff; }
  input {
    font-size: 3.00em;
    padding: 15.00px;
    width: 300.00px;
    margin: 15.00px;
    border-radius: 15.00px;
    border: 1.50px solid #ccc;
    text-align: center;
  }
  button {
    font-size: 2.70em;
    padding: 15.00px 30.00px;
    border: none;
    background: #2b4eff;
    color: white;
    border-radius: 15.00px;
  }
  button:active { background: #1a36b0; }
  table {
    margin: 30.00px auto;
    border-collapse: collapse;
    width: 90%;
    background: white;
    box-shadow: 0 3.00px 9.00px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1.50px solid #ddd;
    padding: 22.50px;
  }
  th { background: #f1f3f6; }
  #status { margin-top: 22.50px; font-weight: bold; color: #333; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥">
  <button onclick="checkCar()">ì¡°íšŒ</button>
  <button onclick="startVoice()">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>

  <div id="status"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // ğŸ”¹ ì°¨ëŸ‰ ë°ì´í„° (HTML ì•ˆì—ì„œ ì§ì ‘ ìˆ˜ì •/ì¶”ê°€ ê°€ëŠ¥)
  const carData = [
    { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
  { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
  { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
  { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
  { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
  { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
  { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
  { ë²ˆí˜¸: "9949", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ(í™•ì¸)", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "jeep" }
  ];

  const inputEl = document.getElementById("carInput");
  const statusEl = document.getElementById("status");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");
  
  // í˜„ì¬ ìŒì„± ì¸ì‹ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
  let recognition; 

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") checkCar();
  });

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰ í•¨ìˆ˜
  function checkCar() {
    const num = inputEl.value.replace(/\D/g, "").padStart(4, "0");
    if (!num) {
      speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      // ìŒì„± ì¸ì‹ì´ í™œì„±í™”ëœ ìƒíƒœë©´ ì—¬ê¸°ì„œ ë©ˆì¶¤
      if (recognition) {
          recognition.stop();
          recognition = null; // ê°ì²´ ì´ˆê¸°í™”
      }
      return;
    }

    // ê²°ê³¼ ì²˜ë¦¬ ë¡œì§ (ì›ë˜ ì½”ë“œì™€ ë™ì¼)
    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    if (found) {
      showResult(found);
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`);
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }
    
    // ì¸ì‹ ì„±ê³µ í›„ ê°ì²´ ì •ë¦¬
    if (recognition) {
        recognition.stop();
        recognition = null;
    }
  }

  // ğŸ”¹ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
  function showResult(data) {
    tbody.innerHTML = `
      <tr>
        <td>${data.ë²ˆí˜¸}</td>
        <td>${data.ìƒ‰ìƒ}</td>
        <td>${data.ì°¨ì¢…}</td>
        <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    `;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸° í•¨ìˆ˜
  function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ko-KR";
    speechSynthesis.speak(utter);
  }

  // ğŸ”¹ ìŒì„± ì¸ì‹ ì‹œì‘ í•¨ìˆ˜
  function startVoice() {
    // ì´ë¯¸ ì¸ì‹ ì¤‘ì´ë©´ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
    if (recognition) return; 

    if (!("webkitSpeechRecognition" in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\ní¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return;
    }

    recognition = new webkitSpeechRecognition(); // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
    recognition.lang = "ko-KR";
    
    // **ëª¨ë°”ì¼ í™˜ê²½ì—ì„œ ì§§ì€ ë°œí™” í›„ ì¸ì‹ì´ ì¤‘ë‹¨ë˜ëŠ” ë¬¸ì œë¥¼ ì™„í™”í•˜ê¸° ìœ„í•´ 'continuous: false'ë¥¼ ìœ ì§€í•˜ê³  ì¬ì‹œì‘ ë¡œì§ìœ¼ë¡œ ë³´ì™„í•©ë‹ˆë‹¤.**
    // recognition.continuous = true; // ì—°ì† ì¸ì‹ ëª¨ë“œëŠ” ëª¨ë°”ì¼ì—ì„œ ë¶ˆì•ˆì •
    recognition.interimResults = false; // ìµœì¢… ê²°ê³¼ë§Œ ë°›ë„ë¡ ì„¤ì • (ì„ íƒ ì‚¬í•­)
    recognition.maxAlternatives = 1;

    recognition.onstart = function() {
        statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";
    };
    
    // ì¸ì‹ ì„±ê³µ
    recognition.onresult = function(event) {
      // recognition.stop(); // onresultì—ì„œ stopì„ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒ ë°œí™”ê°€ ì¸ì‹ë˜ì§€ ì•Šì„ ìˆ˜ ìˆì–´ checkCar()ì—ì„œ ì²˜ë¦¬
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, ""); // ìˆ«ìë§Œ ì¶”ì¶œ
      
      // ìŒì„± ì¸ì‹ì´ '0'ì´ë‚˜ '1004'ì²˜ëŸ¼ ì¸ì‹ë  ë•Œ: ë²ˆí˜¸ê°€ ì§§ìœ¼ë©´ ì¸ì‹ì´ ë¶ˆì™„ì „í•˜ë‹¤ê³  ê°„ì£¼í•  ìˆ˜ ìˆìŒ
      if (num.length >= 2 && num.length <= 4) {
          inputEl.value = num;
          checkCar(); // checkCar ë‚´ë¶€ì—ì„œ recognition.stop() í˜¸ì¶œ
      } else {
          statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
          speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”. ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
          // ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘
          recognition.start();
      }
    };

    // ì¸ì‹ì´ ëë‚¬ì„ ë•Œ (ì˜¤ë¥˜ê°€ ì•„ë‹ˆë”ë¼ë„ ëë‚  ìˆ˜ ìˆìŒ)
    recognition.onend = function() {
        // ì˜¤ë¥˜ê°€ ì•„ë‹Œ ì •ìƒ ì¢…ë£Œì´ê±°ë‚˜, onresultë¥¼ í†µí•´ checkCarê°€ í˜¸ì¶œëœ ê²½ìš° recognition ê°ì²´ëŠ” nullì´ ë©ë‹ˆë‹¤.
        // ê°ì²´ê°€ nullì´ ì•„ë‹ˆë©´, ìŒì„± ì¸ì‹ì´ ì˜ˆìƒì¹˜ ì•Šê²Œ ì¤‘ë‹¨ëœ ê²ƒìœ¼ë¡œ ë³´ê³  ì¬ì‹œì‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        if (recognition) {
            recognition = null; 
            // statusEl.textContent = "ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.";
        }
    };
    
    // â­â­ ì˜¤ë¥˜ ë°œìƒ ì‹œ ì²˜ë¦¬ ë¡œì§ (í•µì‹¬ ìˆ˜ì • ë¶€ë¶„) â­â­
    recognition.onerror = function(event) {
        let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì¼ë°˜ ì˜¤ë¥˜)";
        
        switch(event.error) {
            case 'not-allowed':
                errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'network':
                errorMsg = "âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'no-speech':
                errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.";
                // 'no-speech' ì˜¤ë¥˜ëŠ” ì¬ì‹œì‘ ì‹œë„
                statusEl.textContent = errorMsg + " (ìë™ ì¬ì‹œì‘)";
                speak("ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.");
                recognition.start();
                return; // ì¬ì‹œì‘í–ˆìœ¼ë¯€ë¡œ í•¨ìˆ˜ ì¢…ë£Œ
            case 'aborted':
                // ì‚¬ìš©ìê°€ ì·¨ì†Œí•˜ê±°ë‚˜, checkCarì—ì„œ stop()ì„ í˜¸ì¶œí•œ ê²½ìš° (ì •ìƒ ì¢…ë£Œ)
                errorMsg = "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                break;
            case 'audio-capture':
                errorMsg = "âŒ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•±ì´ ë§ˆì´í¬ë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            case 'service-not-allowed':
                // íŠ¹íˆ ëª¨ë°”ì¼ì—ì„œ ìì£¼ ë°œìƒ (HTTPS í•„ìˆ˜)
                errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. **HTTPS í™˜ê²½**ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                speak(errorMsg);
                break;
            default:
                // ê¸°íƒ€ ì˜¤ë¥˜ ì‹œ (ì˜ˆ: timeout)
                statusEl.textContent = errorMsg + ` (ì˜¤ë¥˜ ì½”ë“œ: ${event.error})`;
                speak(errorMsg + " ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
                
                // â­â­ ëª¨ë°”ì¼ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” Timeout ì˜¤ë¥˜ ë“±ì˜ ê²½ìš° ìë™ ì¬ì‹œì‘ â­â­
                if (recognition) { // ê°ì²´ê°€ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸ í›„
                    try {
                        recognition.start();
                        return; // ì¬ì‹œì‘í–ˆìœ¼ë¯€ë¡œ í•¨ìˆ˜ ì¢…ë£Œ
                    } catch(e) {
                        errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¬ì‹œì‘ ì‹¤íŒ¨: " + e.message;
                    }
                }
                break;
        }

        statusEl.textContent = errorMsg;
        recognition = null; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê°ì²´ ì´ˆê¸°í™”
    };
    
    recognition.start();
  }
  </script>
</body>
</html>