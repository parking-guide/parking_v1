<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</title>
<style>
  body {
    font-family: "Pretendard", sans-serif;
    background: #f9fafb;
    text-align: center;
    padding: 20px;
  }
  h2 { color: #2b4eff; }
  input {
    font-size: 2.0em;
    padding: 10px;
    width: 200px;
    margin: 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    text-align: center;
  }
  button {
    font-size: 1.8em;
    padding: 10px 20px;
    border: none;
    background: #2b4eff;
    color: white;
    border-radius: 10px;
  }
  button:active { background: #1a36b0; }
  table {
    margin: 20px auto;
    border-collapse: collapse;
    width: 90%;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 15px;
  }
  th { background: #f1f3f6; }
  #status { margin-top: 15px; font-weight: bold; color: #333; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸°</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥" inputmode="numeric" pattern="[0-9]*">
  <button onclick="checkCar()">ì¡°íšŒ</button>
  <button id="voiceBtn" onclick="startVoice()">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>

  <div id="status"></div>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
  // ğŸ”¹ ì°¨ëŸ‰ ë°ì´í„° (HTML ì•ˆì—ì„œ ì§ì ‘ ìˆ˜ì •/ì¶”ê°€ ê°€ëŠ¥)
  const carData = [
    { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
    { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
    { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
    { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
    { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
    { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
    { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
    { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
    { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
    { ë²ˆí˜¸: "9949", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ(í™•ì¸)", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "jeep" }
  ];

  const inputEl = document.getElementById("carInput");
  const statusEl = document.getElementById("status");
  const table = document.getElementById("resultTable");
  const tbody = table.querySelector("tbody");
  const voiceBtn = document.getElementById("voiceBtn");

  // --------- ë§ˆì´í¬ ê¶Œí•œ/ìŒì„±ì¸ì‹ ì¬ì‚¬ìš©ì„ ìœ„í•œ í•µì‹¬ ë³€ê²½ ---------
  // 1) ë§ˆì´í¬ ê¶Œí•œì„ ì²« ì‹¤í–‰ ë•Œ í•œ ë²ˆë§Œ ìš”ì²­ (getUserMedia)
  // 2) webkitSpeechRecognition ì¸ìŠ¤í„´ìŠ¤ë¥¼ 'í•œ ë²ˆë§Œ' ìƒì„±í•´ì„œ ê³„ì† ì¬ì‚¬ìš©
  // 3) HTTPS(ì˜ˆ: GitHub Pages)ì—ì„œ ì‚¬ìš© ê¶Œì¥

  let recognition = null;      // ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤
  let isListening = false;     // í˜„ì¬ ì¸ì‹ ì¤‘ì¸ì§€
  let micReady = false;        // ë§ˆì´í¬ ê¶Œí•œ ì¤€ë¹„ ì—¬ë¶€

  // ë§ˆì´í¬ ê¶Œí•œì„ í•œ ë²ˆë§Œ í™•ë³´
  async function ensureMicPermission() {
    if (micReady) return true;
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return true; // ì¼ë¶€ ë¸Œë¼ìš°ì € í˜¸í™˜
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      // ê¶Œí•œë§Œ í™•ë³´í•˜ê³  ì¦‰ì‹œ íŠ¸ë™ ì¢…ë£Œ
      stream.getTracks().forEach(t => t.stop());
      micReady = true;
      return true;
    } catch (e) {
      statusEl.textContent = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì €ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.";
      speak("ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
      return false;
    }
  }

  // webkitSpeechRecognition ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•œ ë²ˆë§Œ ì´ˆê¸°í™”
  function getRecognizer() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
      return null;
    }
    if (recognition) return recognition;

    const r = new webkitSpeechRecognition();
    r.lang = "ko-KR";
    r.interimResults = false;
    r.maxAlternatives = 1;

    r.onstart = function () {
      isListening = true;
      statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";
      voiceBtn.disabled = true;
    };

    r.onresult = function (event) {
      const transcript = event.results[0][0].transcript;
      const num = transcript.replace(/[^0-9]/g, "");
      if (num.length >= 2 && num.length <= 4) {
        inputEl.value = num;
        checkCar();
      } else {
        statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.`;
        speak("ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”. ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.");
        try { r.start(); } catch (_) {}
      }
    };

    r.onerror = function (event) {
      let msg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      switch (event.error) {
        case "not-allowed":
          msg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.";
          break;
        case "no-speech":
          msg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”. ìë™ ì¬ì‹œì‘í•©ë‹ˆë‹¤.";
          statusEl.textContent = msg;
          speak("ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.");
          try { r.start(); return; } catch (_) {}
        case "aborted":
          msg = "ìŒì„± ì¸ì‹ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
          break;
        case "audio-capture":
          msg = "âŒ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•± ì‚¬ìš© ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
          break;
        case "service-not-allowed":
          msg = "âŒ ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
          break;
        default:
          msg = msg + ` (ì½”ë“œ: ${event.error})`;
          try { r.start(); return; } catch (_) {}
      }
      statusEl.textContent = msg;
    };

    r.onend = function () {
      isListening = false;
      voiceBtn.disabled = false;
      statusEl.textContent = "ë§ˆì´í¬ ëŒ€ê¸° ìƒíƒœì…ë‹ˆë‹¤.";
      // ì¸ìŠ¤í„´ìŠ¤ë¥¼ íŒŒê¸°í•˜ì§€ ì•ŠìŒ -> ì¬ì‚¬ìš© ê°€ëŠ¥!
    };

    recognition = r;
    return recognition;
  }

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") checkCar();
  });

  // ğŸ”¹ ì°¨ëŸ‰ ê²€ìƒ‰ í•¨ìˆ˜
  function checkCar() {
    const num = inputEl.value.replace(/\\D/g, "").padStart(4, "0");
    if (!num || num === "0000") {
      speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
      if (isListening && recognition) {
        try { recognition.stop(); } catch (_) {}
      }
      return;
    }

    const found = carData.find(c => c.ë²ˆí˜¸ === num);
    if (found) {
      showResult(found);
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`);
    } else {
      statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
      table.style.display = "none";
      speak(`${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
    }

    if (isListening && recognition) {
      try { recognition.stop(); } catch (_) {}
    }
  }

  // ğŸ”¹ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
  function showResult(data) {
    tbody.innerHTML = \\`
      <tr>
        <td>\\${data.ë²ˆí˜¸}</td>
        <td>\\${data.ìƒ‰ìƒ}</td>
        <td>\\${data.ì°¨ì¢…}</td>
        <td>\\${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
      </tr>
    \\`;
    table.style.display = "table";
    statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
  }

  // ğŸ”¹ ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸° í•¨ìˆ˜
  function speak(text) {
    try {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "ko-KR";
      speechSynthesis.speak(utter);
    } catch (_) {}
  }

  // ğŸ”¹ ìŒì„± ì¸ì‹ ì‹œì‘ í•¨ìˆ˜ (ë²„íŠ¼ í´ë¦­)
  async function startVoice() {
    // 1) HTTPS ê¶Œì¥ ì•ˆë‚´ (GitHub PagesëŠ” ê¸°ë³¸ HTTPS)
    if (location.protocol !== "https:" && location.hostname !== "localhost") {
      statusEl.textContent = "âš ï¸ HTTPSì—ì„œ ì‚¬ìš©í•  ë•Œ ê¶Œí•œì´ ì•ˆì •ì ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.";
    }

    // 2) ê¶Œí•œ í•œ ë²ˆë§Œ í™•ë³´
    const ok = await ensureMicPermission();
    if (!ok) return;

    // 3) ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
    const r = getRecognizer();
    if (!r) return;

    // ì´ë¯¸ ë“£ê³  ìˆìœ¼ë©´ ë‹¤ì‹œ ì‹œì‘í•˜ì§€ ì•ŠìŒ
    if (isListening) return;

    try {
      r.start();
    } catch (e) {
      // start í˜¸ì¶œ íƒ€ì´ë° ë¬¸ì œ ë°©ì§€
      try { r.stop(); } catch (_) {}
      setTimeout(() => {
        try { r.start(); } catch (_) {}
      }, 150);
    }
  }
  </script>
</body>
</html>