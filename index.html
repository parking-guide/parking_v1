<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸° (ìˆ˜ì •ë³¸)</title>
<style>
  body { font-family: "Pretendard", sans-serif; background: #f9fafb; text-align: center; padding: 20px; }
  h2 { color: #2b4eff; }
  input { font-size: 2.0em; padding: 10px; width: 200px; margin: 10px; border-radius: 10px; border: 1px solid #ccc; text-align: center; }
  button { font-size: 1.8em; padding: 10px 20px; border: none; background: #2b4eff; color: white; border-radius: 10px; }
  button:active { background: #1a36b0; }
  table { margin: 20px auto; border-collapse: collapse; width: 90%; background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  th, td { border: 1px solid #ddd; padding: 15px; }
  th { background: #f1f3f6; }
  #status { margin-top: 15px; font-weight: bold; color: #333; }
  small { color: #666; display:block; margin-top:8px; }
</style>
</head>
<body>
  <h2>ğŸ¤ ì£¼ì°¨ ì°¨ëŸ‰ í™•ì¸ê¸° (ìˆ˜ì •ë³¸)</h2>

  <input type="text" id="carInput" placeholder="4ìë¦¬ ë²ˆí˜¸ ì…ë ¥">
  <button id="btnCheck">ì¡°íšŒ</button>
  <button id="btnVoice">ğŸ™ï¸ ìŒì„±ìœ¼ë¡œ ì¡°íšŒ</button>

  <div id="status"></div>
  <small>ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë™ì‘í•˜ì§€ ì•Šìœ¼ë©´: â‘ ë¸Œë¼ìš°ì € ë§ˆì´í¬ ê¶Œí•œ í—ˆìš© â‘¡HTTPS ë˜ëŠ” GitHub Pagesë¡œ ë°°í¬ â†’ ê¶Œì¥</small>

  <table id="resultTable" style="display:none;">
    <thead>
      <tr><th>ë²ˆí˜¸</th><th>ìƒ‰ìƒ</th><th>ì°¨ì¢…</th><th>ì£¼ì°¨ìŠ¤í‹°ì»¤</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const carData = [
  { ë²ˆí˜¸: "0114", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë ˆì´ " },
  { ë²ˆí˜¸: "0136", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "C36 ì•„ìš°ë””" },
  { ë²ˆí˜¸: "0159", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ë² ì´ì§€", ì°¨ì¢…: "ëª¨ë‹" },
  { ë²ˆí˜¸: "0211", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0212", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í¬ë£¨ì¦ˆ" },
  { ë²ˆí˜¸: "0227", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "K7" },
  { ë²ˆí˜¸: "0285", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì„íŒ”ë¼ì‰ë³´ë ˆ" },
  { ë²ˆí˜¸: "0307", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì œë„¤ì‹œìŠ¤" },
  { ë²ˆí˜¸: "0430", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
  { ë²ˆí˜¸: "0448", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ë‹ˆë¡œ" },
  { ë²ˆí˜¸: "0460", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "K7" },
  { ë²ˆí˜¸: "0476", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ë ˆì´" },
  { ë²ˆí˜¸: "0520", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì¹´ë‹ˆë°œ" },
  { ë²ˆí˜¸: "0539", ì£¼ì°¨ìŠ¤í‹°ì»¤: "êµíšŒì°¨ëŸ‰", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "ìŠ¤íƒ€ë ‰ìŠ¤" },
  { ë²ˆí˜¸: "0547", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ(í™•ì¸)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ëª¨ë‹" },
  { ë²ˆí˜¸: "0560", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì˜ë Œí† " },
  { ë²ˆí˜¸: "0563", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ìŠ¤íŒŒí¬" },
  { ë²ˆí˜¸: "0585", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ì†Œë Œí† " },
  { ë²ˆí˜¸: "0627", ì£¼ì°¨ìŠ¤í‹°ì»¤: "í™•ì¸í•„ìš”", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ë””ìŠ¤ì»¤ë²„ë¦¬" },
  { ë²ˆí˜¸: "0636", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "SM5" },
  { ë²ˆí˜¸: "0661", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "SM6" },
  { ë²ˆí˜¸: "0702", ì£¼ì°¨ìŠ¤í‹°ì»¤: "í™•ì¸í•„ìš”", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "k3" },
  { ë²ˆí˜¸: "0757", ì£¼ì°¨ìŠ¤í‹°ì»¤: "í™•ì¸í•„ìš”", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "k3" },
  { ë²ˆí˜¸: "0759", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ì²­ìƒ‰ê³„ì—´", ì°¨ì¢…: "ì†Œë‚˜íƒ€" },
  { ë²ˆí˜¸: "0767", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ì—†ìŒ", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "Benz" },
  { ë²ˆí˜¸: "0841", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ì•„ì´ì˜¤ë‹‰" },
  { ë²ˆí˜¸: "0892", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í°ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "í‹°ë³¼ë¦¬" },
  { ë²ˆí˜¸: "0905", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "ë§ë¦¬ë¶€" },
  { ë²ˆí˜¸: "0982", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ì€_íšŒìƒ‰", ì°¨ì¢…: "íˆ¬ì‚°" },
  { ë²ˆí˜¸: "1045", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "G90" },
  { ë²ˆí˜¸: "1130", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "ê²€ì •ê³„ì—´", ì°¨ì¢…: "íˆ¬ì‚°" },
  { ë²ˆí˜¸: "1138", ì£¼ì°¨ìŠ¤í‹°ì»¤: "í™•ì¸í•„ìš”", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ê·¸ëœì €" },
  { ë²ˆí˜¸: "1178", ì£¼ì°¨ìŠ¤í‹°ì»¤: "ìˆìŒ(í™©ìƒ‰)", ìƒ‰ìƒ: "í°ìƒ‰", ì°¨ì¢…: "ë„¥ì†Œ" },
];

const inputEl = document.getElementById("carInput");
const statusEl = document.getElementById("status");
const table = document.getElementById("resultTable");
const tbody = table.querySelector("tbody");
const btnCheck = document.getElementById("btnCheck");
const btnVoice = document.getElementById("btnVoice");

let recognition = null;
let pendingSpeak = null; // í…ìŠ¤íŠ¸ë¥¼ ë³´ê´€í•˜ì—¬ recognition.onendì—ì„œ ì½ì–´ì£¼ë„ë¡ í•¨

inputEl.addEventListener("keydown", (e) => { if (e.key === "Enter") checkCar(); });
btnCheck.addEventListener("click", checkCar);
btnVoice.addEventListener("click", startVoice);

function checkCar() {
  const num = inputEl.value.replace(/\D/g, "").padStart(4, "0");
  if (!num || /^0+$/.test(num)) {
    statusEl.textContent = "ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.";
    // ì¸ì‹ ì¤‘ì´ë©´ ë©ˆì¶”ê¸°
    if (recognition) {
      // pendingSpeak ì´ˆê¸°í™”
      pendingSpeak = "ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.";
      try { recognition.stop(); } catch(e) { recognition = null; speak(pendingSpeak); pendingSpeak = null; }
    } else {
      speak("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ì”€í•´ì£¼ì„¸ìš”.");
    }
    return;
  }

  const found = carData.find(c => c.ë²ˆí˜¸ === num);
  if (found) {
    showResult(found);
    const text = `${num}ë²ˆ ì°¨ëŸ‰ì€ ${found.ìƒ‰ìƒ} ${found.ì°¨ì¢…}, ì£¼ì°¨ìŠ¤í‹°ì»¤ ${found.ì£¼ì°¨ìŠ¤í‹°ì»¤} ì…ë‹ˆë‹¤.`;
    // ë§Œì•½ ìŒì„± ì¸ì‹ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë©´, ì¦‰ì‹œ speakí•˜ì§€ ë§ê³  onendì—ì„œ ì²˜ë¦¬
    if (recognition) {
      pendingSpeak = text;
      try { recognition.stop(); } catch(e){ recognition=null; speak(text); pendingSpeak=null; }
    } else {
      speak(text);
    }
  } else {
    statusEl.textContent = `ğŸš« ${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
    table.style.display = "none";
    const text = `${num}ë²ˆ ì°¨ëŸ‰ì€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`;
    if (recognition) {
      pendingSpeak = text;
      try { recognition.stop(); } catch(e){ recognition=null; speak(text); pendingSpeak=null; }
    } else {
      speak(text);
    }
  }
}

function showResult(data) {
  tbody.innerHTML = `
    <tr>
      <td>${data.ë²ˆí˜¸}</td>
      <td>${data.ìƒ‰ìƒ}</td>
      <td>${data.ì°¨ì¢…}</td>
      <td>${data.ì£¼ì°¨ìŠ¤í‹°ì»¤}</td>
    </tr>
  `;
  table.style.display = "table";
  statusEl.textContent = "âœ… ì°¨ëŸ‰ ì •ë³´ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
}

// ì•ˆì •ì  ìŒì„± ì¶œë ¥: ê¸°ì¡´ ìŒì„± ì·¨ì†Œ í›„ ì¬ìƒ
function speak(text) {
  if (!text) return;
  try {
    if (speechSynthesis.speaking) {
      speechSynthesis.cancel();
    }
  } catch(e){}
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = "ko-KR";
  // ëª¨ë°”ì¼ì—ì„œ ì¬ìƒì´ ì‹¤íŒ¨í•˜ë©´ onend/onerrorë¡œ ì•Œ ìˆ˜ ìˆìŒ
  utter.onend = function(){ /* no-op */ };
  utter.onerror = function(e){ console.error("TTS error", e); };
  speechSynthesis.speak(utter);
}

// ìŒì„± ì¸ì‹ ì‹œì‘
function startVoice() {
  if (recognition) return;
  if (!("webkitSpeechRecognition" in window)) {
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í¬ë¡¬ ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ì¸ì‹ ê°ì²´ ìƒì„±
  recognition = new webkitSpeechRecognition();
  recognition.lang = "ko-KR";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  statusEl.textContent = "ğŸ™ï¸ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”...";

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    const num = transcript.replace(/[^0-9]/g, "");
    if (num.length >= 2 && num.length <= 4) {
      // ë°”ë¡œ checkCarí•˜ì§€ ë§ê³  input ì±„ìš°ê³  pendingSpeakì— ê²°ê³¼ë¥¼ ë§¡ê¸´ ë’¤ stop() í˜¸ì¶œ
      inputEl.value = num;
      // checkCarê°€ pendingSpeak ë¡œì§ì„ ì²˜ë¦¬í•˜ê²Œ í•¨
      checkCar();
    } else {
      statusEl.textContent = `âš ï¸ ì¸ì‹ëœ ë‚´ìš©("${transcript}")ì—ì„œ ë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
      pendingSpeak = "ë²ˆí˜¸ë¥¼ ì •í™•íˆ ë§ì”€í•´ì£¼ì„¸ìš”. ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.";
      try { recognition.stop(); } catch(e){ recognition = null; speak(pendingSpeak); pendingSpeak = null; }
      // onend ì—ì„œ ì¬ì‹œì‘ ë¡œì§ ì²˜ë¦¬
    }
  };

  recognition.onend = function() {
    // recognitionì´ ì¢…ë£Œë˜ë©´ pendingSpeakì´ ìˆìœ¼ë©´ speakë¡œ ì¶œë ¥
    // ì¸ì‹ì´ ì˜ˆê¸°ì¹˜ ì•Šê²Œ ì¤‘ë‹¨ë˜ì—ˆì„ ë•ŒëŠ” ì¬ì‹œì‘ ì‹œë„ë¥¼ í•˜ì§€ ì•Šê³  ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´
    if (pendingSpeak) {
      // ì•½ê°„ì˜ ì§€ì—°ì„ ë„£ì–´, ë§ˆì´í¬ ìì›ì´ ì™„ì „íˆ í•´ì œëœ ë’¤ ì¬ìƒí•˜ë„ë¡ í•¨
      const toSpeak = pendingSpeak;
      pendingSpeak = null;
      setTimeout(() => speak(toSpeak), 150);
    }
    // clean up
    recognition = null;
    statusEl.textContent = statusEl.textContent || "ì¡°íšŒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.";
  };

  recognition.onerror = function(event) {
    console.warn("recognition.onerror", event);
    let errorMsg = "âŒ ìŒì„± ì¸ì‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
    switch(event.error) {
      case 'not-allowed':
        errorMsg = "âŒ ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ì‚¬ìš©ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.";
        break;
      case 'no-speech':
        errorMsg = "âŒ ìŒì„±ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì„¸ìš”.";
        break;
      case 'audio-capture':
        errorMsg = "âŒ ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì•±ì´ ë§ˆì´í¬ë¥¼ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
        break;
      case 'service-not-allowed':
        errorMsg = "âŒ ë³´ì•ˆ ë¬¸ì œë¡œ ì„œë¹„ìŠ¤ ì‚¬ìš©ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. HTTPS í™˜ê²½ì—ì„œ ì ‘ì†í–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
        break;
      default:
        errorMsg = `âŒ ìŒì„± ì¸ì‹ ì˜¤ë¥˜: ${event.error}`;
    }
    statusEl.textContent = errorMsg;
    // ëª¨ë°”ì¼ì—ì„œ onerror ë’¤ì— ìë™ ì¬ì‹œì‘ì€ í”¼í•˜ëŠ” í¸ì´ ì•ˆì „í•¨.
    pendingSpeak = errorMsg;
    try { recognition.stop(); } catch(e){ recognition = null; speak(errorMsg); pendingSpeak = null; }
  };

  recognition.start();
}
</script>
</body>
</html>
